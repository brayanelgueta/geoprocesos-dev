System.register(["jimu-core","jimu-core/react","jimu-arcgis","jimu-ui"],(function(e,t){var r={},n={},a={},o={};return{setters:[function(e){r.DataSourceManager=e.DataSourceManager,r.React=e.React},function(e){n.useEffect=e.useEffect,n.useMemo=e.useMemo,n.useRef=e.useRef,n.useState=e.useState},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent},function(e){o.Button=e.Button,o.NumericInput=e.NumericInput}],execute:function(){e((()=>{var e={2686:e=>{"use strict";e.exports=a},9244:e=>{"use strict";e.exports=r},8972:e=>{"use strict";e.exports=n},4321:e=>{"use strict";e.exports=o}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,i),a.exports}i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="";var c={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(c),i.d(c,{__set_webpack_public_path__:()=>S,default:()=>E});var e=i(9244),t=i(8972),r=i(2686),n=i(4321);const a={Promise:"undefined"!=typeof window?window.Promise:void 0};var o="4.25",s="next";function u(e){if(e.toLowerCase()===s)return s;var t=e&&e.match(/^(\d)\.(\d+)/);return t&&{major:parseInt(t[1],10),minor:parseInt(t[2],10)}}function l(e){return void 0===e&&(e=o),"https://js.arcgis.com/".concat(e,"/")}function m(e){return!e||u(e)?function(e){void 0===e&&(e=o);var t=l(e),r=u(e);if(r!==s&&3===r.major){var n=r.minor<=10?"js/":"";return"".concat(t).concat(n,"esri/css/esri.css")}return"".concat(t,"esri/themes/light/main.css")}(e):e}function d(e,t){var r=m(e),n=function(e){return document.querySelector('link[href*="'.concat(e,'"]'))}(r);return n||function(e,t){if(t){var r=document.querySelector(t);r.parentNode.insertBefore(e,r)}else document.head.appendChild(e)}(n=function(e){var t=document.createElement("link");return t.rel="stylesheet",t.href=e,t}(r),t),n}var p={};function f(e,t,r){var n;r&&(n=function(e,t){var r=function(n){t(n.error||new Error("There was an error attempting to load ".concat(e.src))),e.removeEventListener("error",r,!1)};return e.addEventListener("error",r,!1),r}(e,r));var a=function(){t(e),e.removeEventListener("load",a,!1),n&&e.removeEventListener("error",n,!1)};e.addEventListener("load",a,!1)}function v(){return document.querySelector("script[data-esri-loader]")}function y(){var e=window.require;return e&&e.on}function g(e){void 0===e&&(e={});var t={};[p,e].forEach((function(e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}));var r=t.version,n=t.url||l(r);return new a.Promise((function(e,a){var o=v();if(o){var i=o.getAttribute("src");i!==n?a(new Error("The ArcGIS API for JavaScript is already loaded (".concat(i,")."))):y()?e(o):f(o,e,a)}else if(y())a(new Error("The ArcGIS API for JavaScript is already loaded."));else{var c=t.css;if(c)d(!0===c?r:c,t.insertCssBefore);o=function(e){var t=document.createElement("script");return t.type="text/javascript",t.src=e,t.setAttribute("data-esri-loader","loading"),t}(n),f(o,(function(){o.setAttribute("data-esri-loader","loaded"),e(o)}),a),document.body.appendChild(o)}}))}function w(e){return new a.Promise((function(t,r){var n=window.require.on("error",r);window.require(e,(function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];n.remove(),t(e)}))}))}const h={es:{widgetLabel:"Detecci\xf3n de Infraestructura Afectada",blur:"Difuminar",density:"Densidad",warning:"Debe cargar datos antes de generar un mapa de calor",apply:"Aplicar",delete:"Eliminar"},en:{widgetLabel:"Detection of Affected Infrastructure",blur:"Blur",density:"Density",warning:"You must load data before generating a heat map",apply:"Apply",delete:"Delete"}};var b=function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{s(n.next(e))}catch(e){o(e)}}function c(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}s((n=n.apply(e,t||[])).next())}))};const E=a=>{var o;const{t:i}=function(e){const r=new URLSearchParams(window.location.search).get("locale")||"es";return{t:(0,t.useMemo)((()=>t=>{var n;return null!==(n=e[r][t])&&void 0!==n?n:t}),[r]),locale:r}}(h),[c,s]=(0,t.useState)(null),[u,l]=(0,t.useState)([]),[m,d]=(0,t.useState)(.319),[p,f]=(0,t.useState)(0),[E,S]=(0,t.useState)(30),[R,I]=(0,t.useState)(null),[C,x]=(0,t.useState)(!1),M=(0,t.useRef)(null),N=()=>b(void 0,void 0,void 0,(function*(){if(!c)return;const[e,t,r,n,a]=yield function(e,t){if(void 0===t&&(t={}),y())return w(e);var r=v(),n=r&&r.getAttribute("src");return!t.url&&n&&(t.url=n),g(t).then((function(){return w(e)}))}(["esri/layers/FeatureLayer","esri/Graphic","esri/geometry/Point","esri/geometry/SpatialReference","esri/smartMapping/renderers/heatmap"]),o=c.view.map.allLayers.find((e=>{if("feature"!==e.type)return!1;if("L\xedmite urbano Plan Regulador Comunal"===e.title)return!1;if("HotSpot"===e.title)return!1;let t=e.parent,r="title"in t?t.title:"No title property";return"Transporte"!==r&&("Infraestructura cr\xedtica"!==r&&("Combustibles"!==r&&("Transmisi\xf3n el\xe9ctrica"!==r&&"Centrales de generaci\xf3n el\xe9ctrica"!==r)))}));if(!o)return void console.log("No se encontr\xf3 ning\xfan layer cargado.");I(o);const i=[],s=new n({wkid:102100}),u=Object(o.source);(null==u?void 0:u.items)||console.log("Layer no tiene items"),u.items.forEach((e=>{var n;const a=new r({x:e.geometry.x,y:e.geometry.y,spatialReference:s});i.push(new t({geometry:a,attributes:{OBJECTID:e.attributes.OBJECTID,Nombre:(null===(n=e.attributes)||void 0===n?void 0:n.NOMBRE)||"Sin Nombre"}}))})),L();const l=new e({title:"HotSpot",source:i,objectIdField:"OBJECTID",fields:[{name:"OBJECTID",alias:"OBJECTID",type:"oid"},{name:"Nombre",alias:"Nombre",type:"string"}],geometryType:"point",spatialReference:c.view.spatialReference,opacity:1});let d={layer:l,view:c.view,renderer:{type:"heatmap",colorStops:[{color:[133,193,200,0],ratio:0},{color:[133,193,200,0],ratio:.01},{color:[133,193,200,255],ratio:.01},{color:[133,193,200,255],ratio:.01},{color:[144,161,190,255],ratio:.0925},{color:[156,129,132,255],ratio:.175},{color:[167,97,170,255],ratio:.2575},{color:[175,73,128,255],ratio:.34},{color:[184,48,85,255],ratio:.4225},{color:[192,24,42,255],ratio:.505},{color:[200,0,0,255],ratio:.5875},{color:[211,51,0,255],ratio:.67},{color:[222,102,0,255],ratio:.7525},{color:[233,153,0,255],ratio:.835},{color:[244,204,0,255],ratio:.9175},{color:[255,255,0,255],ratio:1}],radius:200},blurRadius:E,maxDensity:m,minDensity:p,referenceScale:3e3};a.createRenderer(d).then((e=>{l.renderer=e.renderer,l.listMode="show",l.visible=!0,c.view.map.add(l)})),x(!0)})),D=()=>{if(!c)return;const e=c.view.map.allLayers.filter((e=>{if("feature"!==e.type)return!1;if("L\xedmite urbano Plan Regulador Comunal"===e.title)return!1;if("HotSpot"===e.title)return!1;let t=e.parent,r="title"in t?t.title:"No title property";return"Transporte"!==r&&("Infraestructura cr\xedtica"!==r&&("Combustibles"!==r&&("Transmisi\xf3n el\xe9ctrica"!==r&&"Centrales de generaci\xf3n el\xe9ctrica"!==r)))}));console.log("Layers filtrados:",e),l(e)},L=()=>{if(!c)return;const e=c.view.map.allLayers.find((e=>"HotSpot"===e.title));e&&(c.view.map.remove(e),x(!1))};return(0,t.useEffect)((()=>{if(c)return M.current&&M.current.remove(),M.current=c.view.map.allLayers.on("change",(()=>{!c.view.map.allLayers.find((e=>e===R))&&R&&(console.log("\u26a0\ufe0f Layer fuente ha sido eliminado."),L(),I(null)),D()})),()=>{M.current&&M.current.remove()}}),[c,R]),(0,t.useEffect)((()=>{if(!c)return;const e=((e,t)=>{let r;return(...n)=>{clearTimeout(r),r=setTimeout((()=>e(...n)),t)}})((()=>{u.length>0&&(L(),N())}),1e3),t=c.view.watch("extent",(()=>{C&&e()}));return()=>{t.remove()}}),[c,u,E,m,p]),(0,t.useEffect)((()=>{c&&(D(),(()=>{if(!c)return;const t=e.DataSourceManager.getInstance().getDataSourcesAsArray();console.log("DataSources actuales:",t)})())}),[c]),e.React.createElement("div",{className:"jimu-widget"},a.useMapWidgetIds&&1===a.useMapWidgetIds.length&&e.React.createElement(r.JimuMapViewComponent,{useMapWidgetId:a.useMapWidgetIds[0],onActiveViewChange:e=>{s(e)}}),e.React.createElement("div",{className:"heatmap-main-container"},0===u.length?e.React.createElement("div",{className:"heatmap-container p-4"},e.React.createElement("h5",null,i("warning"))):e.React.createElement("div",{className:"heatmap-container p-4"},e.React.createElement("div",{className:"heatmap-settings"},e.React.createElement("label",{htmlFor:"blur"},i("blur")),e.React.createElement(n.NumericInput,{type:"text",value:E,onChange:e=>S(e)})),e.React.createElement("div",{className:"heatmap-settings"},e.React.createElement("label",{htmlFor:"maxDensity"},"Max ",i("density")),e.React.createElement(n.NumericInput,{type:"text",value:m,onChange:e=>d(e)})),e.React.createElement("div",{className:"heatmap-settings"},e.React.createElement("label",{htmlFor:"minDensity"},"Min ",i("density")),e.React.createElement(n.NumericInput,{type:"text",value:p,onChange:e=>f(e)})),e.React.createElement("div",{className:"heatmap-buttons d-flex justify-content-around mt-3"},e.React.createElement(n.Button,{type:"primary",size:"sm",onClick:()=>N()},i("apply")," hotspot"),e.React.createElement(n.Button,{type:"primary",size:"sm",onClick:()=>L()},i("delete")," hotspot")))),e.React.createElement(r.JimuMapViewComponent,{useMapWidgetId:null===(o=a.useMapWidgetIds)||void 0===o?void 0:o[0],onActiveViewChange:e=>s(e)}))};function S(e){i.p=e}})(),c})())}}}));